<main id="main" class="main">
  <div class="pagetitle">
    <h1>Roles</h1>
    <nav>
       <ol class="breadcrumb">
        <li class="breadcrumb-item"><a routerLink="/">Inicio</a></li>
          <li class="breadcrumb-item">Roles</li>
          <li class="breadcrumb-item active">Index</li>
       </ol>
    </nav>
 </div>
  <div class="card">
    <div class="card-header" style="padding: 0;">
      <div class="banner" style="background-image: url('https://www.cisa.gov/sites/default/files/styles/hero_large/public/2023-01/23_0127_ecd_ps-cyber_header_1600x600.png?h=e0d9a4bb&itok=tn8cHABi%27);');border-top-left-radius:10px;border-top-right-radius:10px; background-size: cover; background-position: center;">
        <div class="overlay"></div>
        <div class="text-center" style="padding: 2rem;">
          <h3 style="font-size: 2rem; font-weight: bold; color: white;">Roles</h3>
          <p style="font-size: 1rem; color: white;">Administración de Roles</p>
        </div>
      </div>
    </div>
    
      
    <div class="card-body">
          
      <div class="row ms-5 col-11">
        <button class="ov-btn-grow-primary mt-3 col-2" style="height: 2.4rem; margin-left: 0;" (click)="goToNextTab()" data-bs-toggle="modal" data-bs-target="#crear" onclick="limpiarCampos()">
          <i class="fas fa-plus-circle mr-1"></i>
          Agregar
        </button>
        
        <div class="search-bar mt-3 col-10">
          <input type="text" class="form-control" placeholder="Buscar..." [(ngModel)]="filtro">
        </div>
      </div>

      <div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 justify-content-center align-items-stretch gap-4 mt-4">
        <div *ngFor="let rol of filtrarRoles() | paginate: { itemsPerPage: 6, currentPage: p }" class="card border shadow rounded-md p-4 d-flex flex-column">
          <div class="card-body">
            <h4 class="text-xl font-semibold mt-5 text-center">{{ rol.role_Nombre }}</h4>
            <span class="badge position-absolute top-0 badge-custom" title="Usuarios con este Rol" [ngClass]="{'ov-btn-grow-primary': rol.role_Cantidad_Usuarios == 0}" style="padding: 6px 12px; border-bottom-left-radius: 9999px; border-bottom-right-radius: 9999px; white-space: nowrap;background-color: #4741d7;color: aliceblue;">Usuarios con este rol: {{ rol.role_Cantidad_Usuarios }}</span>

          </div>
          
          <div class="mt-auto d-flex justify-content-center">
            <div class="dropdown">
              <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" [id]="'dropdownMenuButton' + rol.role_Id" (click)="toggleDropdown(rol.role_Id)" aria-haspopup="true" aria-expanded="false">
                Acciones
              </button>
              <div class="dropdown-menu" [attr.aria-labelledby]="'dropdownMenuButton' + rol.role_Id" [class.show]="isDropdownOpen(rol.role_Id)">
                <a class="dropdown-item btn ov-btn-grow-u p-3 "  style="border: none;"  data-bs-toggle="modal" data-bs-target="#update" (click)="selectRol(rol)">
                  <i class="fas fa-edit"></i>
                  Editar
                </a>
                <a class="dropdown-item btn ov-btn-grow-info p-3"  style="border: none;"  >
                  <i class=" fas fa-info-circle ml-1"></i>
                  Detalles
                </a>
                <a class="dropdown-item btn ov-btn-grow-dark p-3" style="border: none;"  data-bs-toggle="modal" data-bs-target="#pantallas" (click)="selectRolFP(rol)">
                  <i class="  fas fa-desktop ml-1"></i>
                  Pantallas
                </a>                
                <a class="dropdown-item btn ov-btn-grow-d p-3"  style="border: none;"   data-bs-toggle="modal" data-bs-target="#eliminar" (click)="selectRolID(rol)">
                  <i class=" fas fa-trash-alt ml-1"></i>
                  Eliminar
                </a>
              </div>
            </div>
          </div>
          
        </div>
      </div>

      <div class="pagination d-flex justify-content-center mt-4">
        <pagination-controls (pageChange)="p = $event"
                             previousLabel="Anterior"
                             nextLabel="Siguiente"
                             firstLabel="Primera"
                             lastLabel="Última"
                             screenReaderPaginationLabel="Paginación"
                             screenReaderPageLabel="Página"
                             screenReaderCurrentLabel="Página actual">
        </pagination-controls>
      </div>

    </div>
  </div>
</main>

<!--Modal Insert-->
<div class="modal fade" id="crear" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Nuevo Rol</h5>
      </div>
      <div class="modal-body">
        <ul ngbNav #nav="ngbNav" [(activeId)]="active" (navChange)="onNavChange($event)" class="nav-tabs">
          <li [ngbNavItem]="1" >
            <button ngbNavLink>Creación de Rol</button>
            <ng-template ngbNavContent>
              <div class="input-group mb-3 mt-5">
                <span class="input-group-text" id="basic-addon1">
                  <i class="fas fa-edit"></i>
                </span> 
                <input type="text" class="form-control" [(ngModel)]="rolinsert.role_Nombre" id="nombreRolInput" [disabled]="!isTabEnabled(1)" placeholder="Nombre del Rol" aria-label="Username" aria-describedby="basic-addon1" id="nombreRolInput">
              </div>
              <button type="button" class="btn ov-btn-grow-in" style="margin-left: 80%;"  [disabled]="!isTabEnabled(1)" (click)="InsertRol()">Siguiente</button>
            </ng-template>
          </li>
          <li [ngbNavItem]="2" >
            <button ngbNavLink>Asignación de Pantallas</button>
            <ng-template ngbNavContent>
              <p class="mb-5 mt-4">
               <input id="idrol" class="form-control" [(ngModel)]="rolEnvio"  />
                                
                <ng-select
                [items]="people"
                [multiple]="true"
                bindLabel="pant_Descripcion"
                bindValue="pant_Id"
                [selectableGroup]="true"
                [selectableGroupAsModel]="false"
                [closeOnSelect]="false"
                [(ngModel)]="selectedPeople">
                <ng-template ng-optgroup-tmp let-item="item" let-item$="item$" let-index="index">
                    <input id="item-{{index}}" type="checkbox" [ngModel]="item$.selected"/> {{item.pant_Id }}
                </ng-template>
                <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                    <input id="item-{{index}}" type="checkbox" [ngModel]="item$.selected"/> {{item.pant_Descripcion}}
                </ng-template>
                </ng-select>

                          
              </p>

              <div class="row">
                <button type="button" class="btn ov-btn-grow-primary col-4" data-bs-dismiss="modal" style="margin-left: 5px;" (click)="assignLater()">Asignar Luego</button>
                <div class="col-3"></div>
                <button type="button" class="btn ov-btn-grow-in col-4" style="margin-right: 5px; margin-left: 6%;" data-bs-dismiss="modal" (click)="save()">Guardar</button>
              </div>
            </ng-template>
          </li>
        </ul>
        
        <div [ngbNavOutlet]="nav" class="mt-2"></div>
        
      </div>
      <div class="modal-footer">
        
      </div>
    </div>
  </div>
</div>
<!--/Modal Insert-->




 <!-- Modal Update -->
<div class="modal fade" id="update" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Editar Rol</h5>
      </div>
      <div class="modal-body">
        <div class="input-group mb-3 mt-5">
        <span class="input-group-text" id="basic-addon1">
          <i class="fas fa-edit"></i>
        </span> 
        <input type="text" class="form-control"  [(ngModel)]="selectedRol.role_Nombre" id="update_role_Nombre"  placeholder="Nombre del Rol" aria-label="Username" aria-describedby="basic-addon1" >
      </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn ov-btn-grow-d" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-success btn ov-btn-grow-u p-2" (click)="EditarRol()">Guardar</button>
      </div>
    </div>
  </div>
</div>
<!-- /Modal Update -->



<!--Modal Pantallas-->
<div class="modal fade" id="pantallas" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
     <div class="modal-content">
        <div class="modal-header">
           <h5 class="modal-title">Asignación de Pantallas</h5>
        </div>
        <div class="modal-body">
          <ng-select
          [items]="people"
          [multiple]="true"
          bindLabel="pant_Descripcion"
          bindValue="pant_Id"
          [selectableGroup]="true"
          [selectableGroupAsModel]="false"
          [closeOnSelect]="false"
          [(ngModel)]="selectedPantallas">
          <ng-template ng-optgroup-tmp let-item="item" let-item$="item$" let-index="index">
              <input id="item-{{index}}" type="checkbox" [ngModel]="item$.selected"/> {{item.pant_Id }}
          </ng-template>
          <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
              <input id="item-{{index}}" type="checkbox" [ngModel]="item$.selected"/> {{item.pant_Descripcion}}
          </ng-template>
          </ng-select>
        </div>
        <div class="modal-footer"> 
          <button type="button" class="btn ov-btn-grow-d" data-bs-dismiss="modal">Cancelar</button> 
          <button type="button" class="btn btn-success btn ov-btn-grow-u p-2" (click)="saveUpdatePantallas()">Guardar</button></div>

     </div>
  </div>
</div>
<!--/Modal Pantallas-->

<!--Modal Eliminar-->
<div class="modal fade" id="eliminar" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
     <div class="modal-content">
        <div class="modal-header">
          <div class="row justify-content-center">
           <h5 class="modal-title col-12">Esta seguro que desea eliminar este registro?</h5>
          </div>
        </div>
        <div class="modal-body">
          <div class="row justify-content-center mb-2">
          <img src="https://img2.freepng.es/20180320/vuw/kisspng-symbol-font-trash-2-5ab0cac77f1e88.8245172715215356875207.jpg" alt="Not Found" class="w-50" srcset="">
          </div>
          <div class="row justify-content-center">
          <button type="button" class="btn btn-light col-lg-5" data-bs-dismiss="modal">Cancelar</button> 
          <div class="col-lg-1"></div> 
          <button type="button" class="ov-btn-grow-d col-lg-5" (click)="DeleteRol()">Aceptar</button></div>
        </div>
        </div>
        <div class="modal-footer"> 
     </div>
  </div>
</div>
<!--/Modal Eliminar-->
